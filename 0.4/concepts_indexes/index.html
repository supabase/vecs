<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://supabase.github.io/vecs/0.4/concepts_indexes/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Indexes - vecs</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Indexes";
        var mkdocs_page_input_path = "concepts_indexes.md";
        var mkdocs_page_url = "/vecs/0.4/concepts_indexes/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> vecs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Introduction</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../api/">API</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../hosting/">Hosting</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Concepts</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../concepts_collections/">Collections</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../concepts_adapters/">Adapters</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Indexes</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../concepts_metadata/">Metadata</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Integrations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../integrations_openai/">OpenAI</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../integrations_bedrock.md">Bedrock</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../integrations_huggingface_inference_endpoints/">HuggingFace Inference Endpoints</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Support</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../support_changelog/">Changelog</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">vecs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Concepts &raquo;</li>
      <li class="breadcrumb-item active">Indexes</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/supabase/vecs/edit/master/docs/concepts_indexes.md">Edit on supabase/vecs</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="indexes">Indexes</h1>
<p>Indexes are tools for optimizing query performance of a <a href="../concepts_collections/">collection</a>.</p>
<p>Collections can be <a href="../api/#query">queried</a> without an index, but that will emit a python warning and should never be done in production.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>query does not have a covering index for cosine_similarity. See Collection.create_index
</span></code></pre></div>
<p>As each query vector must be checked against every record in the collection. When the number of dimensions and/or number of records becomes large, that becomes extremely slow and computationally expensive.</p>
<p>An index is a heuristic datastructure that pre-computes distances among key points in the vector space. It is smaller and can be traversed more quickly than the whole collection enabling <strong>much</strong> more performant seraching.</p>
<p>Only one index may exist per-collection. An index optimizes a collection for searching according to a selected distance measure.</p>
<p>To create an index:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">docs</span><span class="o">.</span><span class="n">create_index</span><span class="p">()</span>
</span></code></pre></div>
<p>You may optionally provide a distance measure and index method.</p>
<p>Available options for distance <code>measure</code> are:</p>
<ul>
<li><code>vecs.IndexMeasure.cosine_distance</code></li>
<li><code>vecs.IndexMeasure.l2_distance</code></li>
<li><code>vecs.IndexMeasure.max_inner_product</code></li>
</ul>
<p>which correspond to different methods for comparing query vectors to the vectors in the database.</p>
<p>If you aren't sure which to use, the default of cosine_distance is the most widely compatible with off-the-shelf embedding methods.</p>
<p>Available options for index <code>method</code> are:</p>
<ul>
<li><code>vecs.IndexMethod.auto</code></li>
<li><code>vecs.IndexMethod.hnsw</code></li>
<li><code>vecs.IndexMethod.ivfflat</code></li>
</ul>
<p>Where <code>auto</code> selects the best available index method, <code>hnsw</code> uses the <a href="https://github.com/pgvector/pgvector#hnsw">HNSW</a> method and <code>ivfflat</code> uses <a href="https://github.com/pgvector/pgvector#ivfflat">IVFFlat</a>.</p>
<p>HNSW and IVFFlat indexes both allow for parameterization to control the speed/accuracy tradeoff. vecs provides sane defaults for these parameters. For a greater level of control you can optionally pass an instance of <code>vecs.IndexArgsIVFFlat</code> or <code>vecs.IndexArgsHNSW</code> to <code>create_index</code>'s <code>index_arguments</code> argument. Descriptions of the impact for each parameter are available in the <a href="https://github.com/pgvector/pgvector">pgvector docs</a>.</p>
<p>When using IVFFlat indexes, the index must be created <strong>after</strong> the collection has been populated with records. Building an IVFFlat index on an empty collection will result in significantly reduced recall. You can continue upserting new documents after the index has been created, but should rebuild the index if the size of the collection more than doubles since the last index operation.</p>
<p>HNSW indexes can be created immediately after the collection without populating records.</p>
<p>To manually specify <code>method</code>, <code>measure</code>, and <code>index_arguments</code> add them as arguments to <code>create_index</code> for example:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">docs</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">method</span><span class="o">=</span><span class="n">IndexMethod</span><span class="o">.</span><span class="n">hnsw</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">measure</span><span class="o">=</span><span class="n">IndexMeasure</span><span class="o">.</span><span class="n">cosine_distance</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">measure</span><span class="o">=</span><span class="n">IndexArgsHNSW</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="mi">8</span><span class="p">),</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="p">)</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The time required to create an index grows with the number of records and size of vectors.
For a few thousand records expect sub-minute a response in under a minute. It may take a few
minutes for larger collections.</p>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../concepts_adapters/" class="btn btn-neutral float-left" title="Adapters"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../concepts_metadata/" class="btn btn-neutral float-right" title="Metadata">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../concepts_adapters/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../concepts_metadata/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
      <script src="../js/version-select.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
